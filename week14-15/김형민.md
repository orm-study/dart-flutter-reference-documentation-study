
Flutter가 위젯 계층 구조를 실제 화면에 그려지는 픽셀로 변환하는 과정에 대해 다룸

### Flutter의 렌더링 모델

Android와 iOS의 UI 라이브러리에 대한 추상화를 최소화함

시스템 UI 위젯 라이브러리를 우회

자체 위젯 세트 사용

네이티브 코드로 컴파일

Skia(미래에는 Impeller) 엔진으로 렌더링

### 렌더링 파이프라인

1. 유저 인풋 : 키보드, 터치 스크린 등의 입력 제스처에 대한 반응
2. 애니메이션 : 타이머의 틱에 의해 트리거되는 사용자 인터페이스 변경
3. 빌드 : 화면에 위젯을 생성하는 앱 코드
4. 레이아웃 : 화면에 요소들을 위치시키고 사이즈를 조절
5. 페인트 : 요소들을 시각적 표현으로 변환
6. 컴포지션 : 그리기 순서에 따라 시각적 요소들을 오버레이
7. 래스터라이즈 : 출력을 GPU 렌더링 명령으로 변환

레이아웃, 페인트, 컴포지션이 렌더링

### 빌드: 위젯에서 엘리먼트까지

build 메서드 호출

현재 앱 상태를 기반으로 UI를 렌더링하는 위젯의 하위 트리를 반환

빌드 과정에서 상태에 따라 필요하면 새 위젯 도입 가능

표현된 위젯 -> 엘리먼트 트리로 변환

엘리먼트 : 트리 구조의 특정 위치에서 위젯의 특정 인스턴스

- ComponentElement : 다른 엘리먼트를 호스팅
- RenderObjectElement : 레이아웃이나 페인팅 단계에 참여

위젯의 엘리먼트는 BuildeContext를 통해 참조 가능

BuildeContext : 위젯 트리에서 위치를 핸들링

### 레이아웃과 렌더링

RenderObject : 렌더 트리 노드의 기본 클래스. 2D 데카르트 공간에서 고정 크기를 가짐

2D 데카르트 공간 : x, y로 표현되는 2차원 평면

레이아웃, 페인팅을 위한 추상 모델을 정의

RenderObjectElement마다 RenderObject에서 상속된 객체를 생성, 업데이트

- 텍스트 : RenderParagraph
- 이미지 : RenderImage

Flutter의 위젯들 : RenderObject를 나타내는 RenderBox의 하위 클래스를 상속받는 객체에 의해 렌더링됨

RenderBox : 박스 제약 모델의 기초 제공, 위젯의 렌더링될 최소/최대 너비와 높이 설정

레이아웃을 위해 Flutter는 렌더 트리를 DFS로 순회. 부모에서 자식으로 크기 제약 전달

순회를 마치면 모든 객체는 부모 제약 내의 크기를 가짐

박스 제약 모델 : 객체를 O(n) 시간 내에 배치하는 방법

- 부모는 최대 최소 제약을 같은 값으로 설정해 자식 크기를 지정할 수 있음
- 너비는 지정하고 높이는 유연하게 줄 수 있다(반대도 가능)

LayoutBuilder 위젯을 통해 제약에 따라 다른 렌더링을 할 수 있다

RenderView : 모든 RenderObject의 루트

플랫폼이 새 프레임을 렌더링해야할때

 - comopsiteFrame() 메서드 호출 (렌더 트리의 루트에 있는 RenderView 객체의 일부)
 - SceneBuilder 생성 (장면 업데이트를 트리거)
 - 장면 완료 -> RenderView 객체가 합성된 장면을 Window.render()에 전달
 - GPU에 제어를 넘겨 렌더링 수행
